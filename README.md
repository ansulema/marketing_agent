# Marketing Agent

AI-агент для планирования маркетинговых мероприятий. Использует ReAct паттерн — LLM решает какой инструмент вызвать, агент выполняет локальную Python-функцию, результат возвращается в LLM для анализа.

## Как работает

1. Пользователь описывает задачу
2. LLM анализирует и генерирует `<tool_call>` с именем функции и аргументами
3. Агент парсит вызов и выполняет **локальную Python-функцию**
4. Результат отправляется обратно в LLM
5. LLM либо вызывает следующий инструмент, либо формирует финальный ответ

## Запуск

```bash
python app.py
```

Открыть http://localhost:7860

---

## Глоссарий

### Основные термины

**ЦА (Целевая аудитория)** — группа людей, на которых направлена маркетинговая активность. Определяется по демографии, интересам, поведению.

**Лид (Lead)** — потенциальный клиент, который оставил контакт (email, телефон, заявку). Ещё не купил, но проявил интерес.

**Pain points (Боли)** — проблемы и потребности ЦА, которые решает продукт. Используются в рекламных сообщениях.

**B2B (Business-to-Business)** — продажи другим компаниям. Длинный цикл сделки, высокий чек, мало клиентов.

**B2C (Business-to-Consumer)** — продажи конечным потребителям. Короткий цикл, низкий чек, много клиентов.

### Цели кампаний

**Awareness (Узнаваемость)** — цель: чтобы люди узнали о бренде/продукте. Метрики: охват, показы, упоминания. Не даёт прямых продаж.

**Leads (Лидогенерация)** — цель: собрать контакты потенциальных клиентов. Метрики: количество заявок, стоимость лида.

**Sales (Продажи)** — цель: прямые продажи. Метрики: выручка, количество заказов, средний чек.

**Retention (Удержание)** — цель: удержать существующих клиентов, повторные покупки. Метрики: churn rate, повторные покупки, LTV.

### Финансовые метрики

**CAC (Customer Acquisition Cost)** — стоимость привлечения клиента. Сколько денег потратили на маркетинг, чтобы получить одного платящего клиента.
```
CAC = Затраты на маркетинг / Количество новых клиентов
Пример: потратили 100,000₽, получили 10 клиентов → CAC = 10,000₽
```

**LTV (Lifetime Value)** — пожизненная ценность клиента. Сколько денег принесёт клиент за всё время работы с компанией.
```
LTV = Средний чек × Количество покупок × Время жизни клиента
Пример: чек 5,000₽ × 4 покупки в год × 3 года = LTV 60,000₽
```

**LTV/CAC Ratio** — отношение LTV к CAC. Показывает окупаемость привлечения клиента.
```
LTV/CAC = 60,000 / 10,000 = 6.0
Значит: на каждый вложенный рубль получаем 6 рублей за время жизни клиента
Норма: > 3.0 (хорошо), < 1.0 (убыток)
```

**ROI (Return on Investment)** — возврат инвестиций. См. описание в estimate_roi.

**CPC (Cost Per Click)** — стоимость клика. См. описание в estimate_roi.

**CR (Conversion Rate)** — коэффициент конверсии. См. описание в estimate_roi.

### Маркетинговые каналы

**Контекстная реклама** — реклама в поисковиках (Яндекс.Директ, Google Ads). Показывается по запросам пользователей. Горячий трафик — люди уже ищут решение.

**SMM (Social Media Marketing)** — продвижение в соцсетях (VK, Instagram, Telegram). Охватный канал, хорош для awareness.

**SEO (Search Engine Optimization)** — оптимизация сайта для поисковиков. Бесплатный органический трафик, но долго (3-6 месяцев до результата).

**Email-маркетинг** — рассылки по базе подписчиков. Дешёвый канал, высокий ROI, работает на retention и nurturing лидов.

**Контент-маркетинг** — создание полезного контента (статьи, видео, подкасты). Привлекает органический трафик, строит экспертность.

**Influencer-маркетинг** — реклама у блогеров. Доступ к лояльной аудитории, но сложно измерить эффективность.

**Ремаркетинг (Retargeting)** — показ рекламы людям, которые уже были на сайте. Догоняем тех, кто не купил с первого раза. Высокая конверсия.

**Performance-реклама** — реклама с оплатой за результат (клики, конверсии). Фокус на измеримых метриках и оптимизации.

**CRM-маркетинг** — коммуникации на основе данных из CRM (история покупок, сегменты). Персонализированные предложения существующим клиентам.

**Партнёрский маркетинг (Affiliate)** — привлечение клиентов через партнёров за комиссию от продаж.

---

## Инструменты

### 1. `analyze_target_audience`

**Что делает:** Возвращает характеристики целевой аудитории по отрасли.

**Параметры:**
- `product_or_service` (обязательный) — название продукта
- `industry` (опционально) — отрасль: IT, ритейл, финансы

**Логика:**
Есть словарь с данными по отраслям:
```python
industry_data = {
    "IT": {
        "primary_segments": ["разработчики", "IT-менеджеры", "CTO/CIO", "стартаперы"],
        "age_range": "25-45",
        "income": "выше среднего",
        "pain_points": ["нехватка времени", "сложность выбора технологий", "масштабирование"],
        "channels": ["Habr", "LinkedIn", "профильные конференции", "Telegram"]
    },
    "ритейл": {
        "primary_segments": ["владельцы магазинов", "категорийные менеджеры", "байеры"],
        "age_range": "30-55",
        "pain_points": ["конкуренция с маркетплейсами", "управление ассортиментом"],
        "channels": ["отраслевые выставки", "email", "WhatsApp Business"]
    },
    "финансы": {
        "primary_segments": ["частные инвесторы", "предприниматели", "финансовые директора"],
        "age_range": "30-55",
        "pain_points": ["риски", "доходность", "надёжность"],
        "channels": ["деловые СМИ", "LinkedIn", "вебинары"]
    }
}
```
Функция ищет `industry` в словаре, если не находит — возвращает дефолтные данные.

**Возвращает:** сегменты ЦА, возраст, доход, боли, рекомендуемые каналы.

---

### 2. `estimate_roi`

**Что делает:** Оценивает ROI для типа маркетинговой активности.

**Параметры:**
- `activity_type` (обязательный) — тип активности: контекстная реклама, SMM, email-маркетинг, event, influencer, SEO, контент-маркетинг
- `budget` (обязательный) — бюджет в рублях
- `duration_days` (опционально, default=30) — длительность в днях

**Метрики:**

**ROI (Return on Investment)** — возврат инвестиций. Сколько рублей получишь на каждый вложенный.
```
ROI = Доход / Затраты
ROI 2.5 означает: вложил 100₽ → получил 250₽
```

**Conversion Rate (CR)** — коэффициент конверсии. Какой % людей совершит целевое действие.
```
CR = Конверсии / Посетители
CR 0.03 означает: из 100 посетителей 3 станут лидами
```

**CPC (Cost Per Click)** — стоимость клика. Сколько платишь за один переход на сайт. В коде используется как справочная информация.

**Логика:**

Бенчмарки по типам активностей (средние по рынку):
```python
activity_benchmarks = {
    "контекстная реклама": {"avg_roi": 2.5, "conversion_rate": 0.03, "cpc_range": "30-150₽"},
    "smm":                 {"avg_roi": 1.8, "conversion_rate": 0.015, "cpc_range": "5-50₽"},
    "email-маркетинг":     {"avg_roi": 4.2, "conversion_rate": 0.025, "cpc_range": "1-5₽"},
    "event":               {"avg_roi": 3.0, "conversion_rate": 0.1,   "cpc_range": "500-5000₽"},
    "influencer":          {"avg_roi": 2.0, "conversion_rate": 0.02,  "cpc_range": "50-500₽"},
    "seo":                 {"avg_roi": 5.5, "conversion_rate": 0.04,  "cpc_range": "0₽"},
    "контент-маркетинг":   {"avg_roi": 3.8, "conversion_rate": 0.02,  "cpc_range": "10-100₽"}
}
```

Почему такие значения:
- Email ROI 4.2 — самый высокий, канал почти бесплатный
- SEO ROI 5.5 — органика бесплатна после инвестиций в контент
- SMM ROI 1.8 — много охвата, мало конверсий
- Event CR 0.1 (10%) — люди пришли целенаправленно, высокая конверсия

Расчёт:
```python
# Пример: бюджет 100,000₽ на контекст, 30 дней
estimated_revenue = budget * avg_roi           # 100,000 * 2.5 = 250,000₽
estimated_leads = budget * conversion_rate     # 100,000 * 0.03 = 3,000 (упрощённо)
duration_factor = min(duration_days / 30, 2.0) # 30/30 = 1.0

final_revenue = 250,000 * 1.0 = 250,000₽
final_leads = 3,000 * 1.0 = 3,000
```

Примечание: `estimated_leads = budget * conversion_rate` — упрощение. Правильнее было бы `leads = (budget / cpc) * conversion_rate`, но CPC — диапазон, поэтому используется бюджет как proxy для масштаба.

**Возвращает:** ожидаемый ROI, выручку, количество лидов, стоимость клика.

---

### 3. `analyze_seasonality`

**Что делает:** Определяет сезонность для отрасли и текущего месяца.

**Параметры:**
- `industry` (обязательный) — отрасль
- `current_month` (опционально) — месяц для анализа

**Логика:**
Словарь с пиковыми и низкими сезонами:
```python
seasonality_data = {
    "ритейл": {
        "peak_months": ["ноябрь", "декабрь", "март"],  # Чёрная пятница, НГ, 8 марта
        "low_months": ["январь", "февраль", "июль"],
        "events": ["Чёрная пятница", "Новый год", "8 марта", "Back to school"]
    },
    "IT": {
        "peak_months": ["сентябрь", "октябрь", "март"],  # Бюджетирование, конференции
        "low_months": ["июль", "август", "январь"],       # Отпуска
        "events": ["бюджетирование Q4", "конференции осенью"]
    },
    "туризм": {
        "peak_months": ["июнь", "июль", "август", "декабрь"],
        "low_months": ["ноябрь", "март", "апрель"]
    },
    "образование": {
        "peak_months": ["август", "сентябрь", "январь"],  # Начало года, семестра
        "low_months": ["июнь", "июль", "декабрь"]
    }
}
```

Проверяет `current_month in peak_months` или `in low_months`.

**Возвращает:** пиковый/низкий сезон, список событий, рекомендацию.

---

### 4. `channel_effectiveness`

**Что делает:** Ранжирует маркетинговые каналы по эффективности для цели.

**Параметры:**
- `goal` (обязательный) — цель: awareness, leads, sales, retention
- `target_audience_age` (опционально) — возраст ЦА
- `budget_range` (опционально) — диапазон бюджета

**Логика:**
Оценки каналов (1-10) по целям:
```python
channel_scores = {
    "awareness": {
        "YouTube": 9, "TikTok": 8, "Instagram": 8, "VK": 7,
        "Telegram": 6, "контекстная реклама": 5, "наружная реклама": 7
    },
    "leads": {
        "контекстная реклама": 9, "LinkedIn": 8, "email": 7,
        "вебинары": 8, "Telegram": 6, "SEO": 7
    },
    "sales": {
        "контекстная реклама": 9, "ремаркетинг": 9, "email": 8,
        "маркетплейсы": 8, "партнёрки": 7
    },
    "retention": {
        "email": 9, "push-уведомления": 8, "программы лояльности": 9,
        "Telegram": 7, "SMS": 6
    }
}
```

Сортирует каналы по score и возвращает топ-5.

**Возвращает:** рейтинг каналов с приоритетами, топ-рекомендацию.

---

### 5. `competitor_benchmark`

**Что делает:** Возвращает отраслевые бенчмарки по маркетингу.

**Параметры:**
- `industry` (обязательный) — отрасль
- `company_size` (опционально) — размер компании: малый, средний, крупный

**Логика:**
Бенчмарки по отраслям:
```python
benchmarks = {
    "IT": {
        "avg_marketing_budget_percent": 12,  # % от выручки на маркетинг
        "top_channels": ["контент-маркетинг", "конференции", "LinkedIn"],
        "avg_cac": 15000,      # Средняя стоимость привлечения клиента
        "avg_ltv_cac_ratio": 3.5  # Отношение LTV к CAC
    },
    "ритейл": {
        "avg_marketing_budget_percent": 8,
        "avg_cac": 500,
        "avg_ltv_cac_ratio": 4.0
    },
    "финансы": {
        "avg_marketing_budget_percent": 15,
        "avg_cac": 25000,
        "avg_ltv_cac_ratio": 5.0
    }
}
```

CAC корректируется на размер компании:
```python
size_multiplier = {"малый": 0.7, "средний": 1.0, "крупный": 1.5}
avg_cac = base_cac * size_multiplier
```

**Возвращает:** % бюджета от выручки, топ-каналы отрасли, CAC, LTV/CAC ratio.

---

### 6. `budget_allocator`

**Что делает:** Распределяет бюджет по каналам в зависимости от цели.

**Параметры:**
- `total_budget` (обязательный) — общий бюджет в рублях
- `primary_goal` (обязательный) — цель: awareness, leads, sales, retention
- `industry` (опционально) — отрасль

**Логика:**
Процентное распределение по целям:
```python
allocations = {
    "awareness": {
        "digital-реклама": 0.35, "SMM": 0.25, "контент": 0.15,
        "influencer": 0.15, "PR": 0.10
    },
    "leads": {
        "контекстная реклама": 0.40, "SEO/контент": 0.20, "email": 0.15,
        "вебинары/events": 0.15, "ремаркетинг": 0.10
    },
    "sales": {
        "performance-реклама": 0.45, "ремаркетинг": 0.20, "email": 0.15,
        "партнёрские программы": 0.10, "CRM-маркетинг": 0.10
    },
    "retention": {
        "email/CRM": 0.35, "программа лояльности": 0.25, "контент": 0.15,
        "SMM": 0.15, "push/SMS": 0.10
    }
}
```

Умножает `total_budget` на каждый процент.

**Возвращает:** распределение по каналам в рублях и процентах, приоритетный канал.

---

### 7. `estimate_budget`

**Что делает:** Оценивает минимальный и оптимальный бюджет если пользователь его не указал.

**Параметры:**
- `goal` (обязательный) — цель кампании
- `industry` (обязательный) — отрасль
- `target_leads` (опционально) — желаемое количество лидов
- `company_size` (опционально) — размер компании: стартап, малый, средний, крупный

**Логика:**
CAC по отраслям:
```python
industry_cac = {
    "IT":         {"min": 10000, "avg": 15000, "max": 25000},
    "ритейл":     {"min": 300,   "avg": 500,   "max": 1000},
    "финансы":    {"min": 15000, "avg": 25000, "max": 50000},
    "образование":{"min": 2000,  "avg": 5000,  "max": 10000},
    "saas":       {"min": 8000,  "avg": 15000, "max": 30000},
    "b2b":        {"min": 10000, "avg": 20000, "max": 40000},
    "e-commerce": {"min": 200,   "avg": 400,   "max": 800}
}
```

Множители по целям:
```python
goal_multipliers = {
    "awareness": 0.5,   # Дешевле, но без прямых конверсий
    "leads": 1.0,
    "sales": 1.3,       # Дороже
    "retention": 0.4    # Дешевле
}
```

Множители по размеру:
```python
size_multipliers = {"стартап": 0.5, "малый": 0.7, "средний": 1.0, "крупный": 2.0}
```

Если указан `target_leads`:
```python
budget = target_leads * cac * goal_multiplier * size_multiplier
```

Если не указан — базовые рекомендации:
```python
base_budgets = {
    "стартап": {"min": 50000,   "optimal": 150000,  "max": 300000},
    "малый":   {"min": 100000,  "optimal": 300000,  "max": 500000},
    "средний": {"min": 300000,  "optimal": 700000,  "max": 1500000},
    "крупный": {"min": 1000000, "optimal": 3000000, "max": 10000000}
}
```

**Возвращает:** минимальный, оптимальный, максимальный бюджет, рекомендуемый период.

---

### 8. `estimate_campaign_duration`

**Что делает:** Оценивает оптимальную длительность кампании если пользователь не указал сроки.

**Параметры:**
- `goal` (обязательный) — цель кампании
- `budget` (опционально) — бюджет
- `industry` (опционально) — отрасль
- `urgency` (опционально) — срочность: срочно, стандартно, долгосрочно

**Логика:**
Базовые сроки по целям (в днях):
```python
goal_durations = {
    "awareness": {"min": 30, "optimal": 90,  "max": 180},  # Нужно время на охват
    "leads":     {"min": 14, "optimal": 45,  "max": 90},   # Нужно тестирование
    "sales":     {"min": 7,  "optimal": 30,  "max": 60},   # Быстрый результат
    "retention": {"min": 30, "optimal": 90,  "max": 365}   # Долгосрочная стратегия
}
```

Корректировка на срочность:
```python
urgency_multipliers = {"срочно": 0.5, "стандартно": 1.0, "долгосрочно": 2.0}
```

Корректировка на бюджет:
```python
if budget < 100000:
    budget_factor = 0.7   # Маленький бюджет — короче кампания
elif budget < 500000:
    budget_factor = 1.0
else:
    budget_factor = 1.3   # Большой бюджет — можно дольше тестировать
```

Лучшие месяцы для старта по отраслям:
```python
best_start_months = {
    "IT": ["январь", "сентябрь"],
    "ритейл": ["сентябрь", "октябрь"],
    "образование": ["август", "январь"],
    "финансы": ["январь", "апрель", "сентябрь"]
}
```

**Возвращает:** минимальные/оптимальные/максимальные сроки в днях и читаемом формате, лучшие месяцы для старта.

---

## Файлы

- `marketing_agent.py` — агент и все инструменты
- `app.py` — Gradio интерфейс
- `test_agent.py` — отладочный скрипт
